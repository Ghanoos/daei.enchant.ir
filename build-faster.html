<!DOCTYPE html>
<html dir="rtl" lang="fa">
  
  <head><meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="author" content="مهدی صادقی" />
<meta name="copyright" content="Commons Attribution 4.0 International" />
<meta name="robot" content="" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="description" content="سکوی انتشار مطالبی در مورد دانش تولید نرم‌افزار و ایده‌ها و علایق شخصی‌ام." />

<link rel="canonical" href="https://mehdix.ir/publishing-with-jekyll.html" />
<link rel="icon" href="https://mehdix.ir/assets/img/me.png" />
<link rel="stylesheet" href="https://mehdix.ir/assets/css/main.css" />
<link rel="stylesheet" href="https://mehdix.ir/assets/fonts/fontawesomev5.0.2.css" />
<meta name="keywords" content='بیلد,روبی,کشینگ,جکیل,پروفایلینگ' /><title>بیلد سریع‌تر وبسایت - مهدی صادقی</title><!-- Begin Jekyll SEO tag v2.4.0 -->
<title>بیلد سریع‌تر وبسایت | مهدی صادقی</title>
<meta name="generator" content="Jekyll v3.7.2" />
<meta property="og:title" content="بیلد سریع‌تر وبسایت" />
<meta name="author" content="مهدی صادقی" />
<meta property="og:locale" content="fa_IR" />
<meta name="description" content="وبسایت من در حال حاضر حاوی ۵۶ یادداشت است. لپ‌تاپ Core i5 من حدود ۱۲ ثانیه زمان نیاز دارد تا وبسایت را بیلد کند. با انجام تغییراتی این زمان را به حدود ۳ ثانیه کاهش دادم." />
<meta property="og:description" content="وبسایت من در حال حاضر حاوی ۵۶ یادداشت است. لپ‌تاپ Core i5 من حدود ۱۲ ثانیه زمان نیاز دارد تا وبسایت را بیلد کند. با انجام تغییراتی این زمان را به حدود ۳ ثانیه کاهش دادم." />
<link rel="canonical" href="https://mehdix.ir/build-faster.html" />
<meta property="og:url" content="https://mehdix.ir/build-faster.html" />
<meta property="og:site_name" content="مهدی صادقی" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-02-05T00:00:00+01:00" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@msadeghii" />
<meta name="twitter:creator" content="@مهدی صادقی" />
<script type="application/ld+json">
{"@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://mehdix.ir/build-faster.html"},"url":"https://mehdix.ir/build-faster.html","author":{"@type":"Person","name":"مهدی صادقی"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://mehdix.ir/assets/img/me.png"},"name":"مهدی صادقی"},"description":"وبسایت من در حال حاضر حاوی ۵۶ یادداشت است. لپ‌تاپ Core i5 من حدود ۱۲ ثانیه زمان نیاز دارد تا وبسایت را بیلد کند. با انجام تغییراتی این زمان را به حدود ۳ ثانیه کاهش دادم.","headline":"بیلد سریع‌تر وبسایت","dateModified":"2018-02-05T00:00:00+01:00","datePublished":"2018-02-05T00:00:00+01:00","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  </head>

  <body><header>
  <div class="wrapper">
    <a class="site-title" href="https://mehdix.ir/">مهدی صادقی</a>
    <small id="motto"> در مورد نرم‌افزار و ایده‌هایم </small>
  </div>
</header>
<main>
      <div class="wrapper">

<article class="post-content">

  <div class="post-header">
    <h1 class="post-title">بیلد سریع‌تر وبسایت</h1>
    <p>
      <i class="fas fa-calendar"></i>
      دوشنبه ۱۶ بهمن ۱۳۹۶<br>
      
      <i class="fas fa-stopwatch"></i>
      ۳ دقیقه مطالعه
    </p>
  </div>

  <p>وبسایت من در حال حاضر حاوی ۵۶ یادداشت است. لپ‌تاپ Core i5 من حدود ۱۲ ثانیه زمان نیاز دارد تا وبسایت را بیلد کند. با انجام تغییراتی این زمان را به حدود ۳ ثانیه کاهش دادم.</p>

<p>قبلا ‏<a href="merciless-simplification.html">نوشته</a> بودم که با تغییراتی به کمک پروفایلر بیلد را سریع‌تر کرده‌ام. اینبار تغییرات زیربنایی‌تری دادم که بیلد از آن هم سریع‌تر بشود. چرا که بیلد وبسایتم با همه دنگ و فنگش به حدود ۱۲ ثانیه رسیده بود و مطمئنم اگر در حال خواندن این متن هستید تصدیق خواهید کرد که چنین سرعتی اصلا قابل قبول نیست!</p>

<h2 id="چه-چیزی-کند-بود">چه چیزی کند بود؟</h2>
<p>دو چیز:</p>
<ol>
  <li><a href="https://github.com/pattex/jekyll-tagging">پلاگینی</a> که برای تولید تگ‌ها و تگ‌کلاود استفاده می‌کردم.</li>
  <li>دستورات <code class="highlighter-rouge">include</code> درون قالب.</li>
</ol>

<h2 id="فورک-پلاگین-و-حل-مشکل-کندی-آن">فورک پلاگین و حل مشکل کندی آن</h2>
<p>دفعه گذشته که روی سایت کار کردم به کمک پروفایلر متوجه شدم که این پلاگین خیلی کند است. از جایی که کارش را به خوبی انجام می‌دهد و پلاگین بهتری هم پیدا نکردم تصمیم گرفتم بهبودش بدهم. دو فکر به ذهنم رسید. یکی اینکه الگوریتم استفاده شده در پلاگین را تغییر بدهم و دیگر اینکه سعی کنم دستورات تکراری را ذخیره کنم.</p>

<p>از جایی که من یک برنامه‌نویس مبتدی روبی هستم و با مقداری جستجو به راه حلی برای بهبود فوری نرسیدم، بهبود کد و الگوریتم پلاگین کار پر دردسری به نظرم رسید. البته چیزهایی دستگیرم شد. مثلا <a href="https://github.com/pattex/jekyll-tagging/blob/master/lib/jekyll/tagging.rb#L15">این خط</a> بسیار کند اجرا می‌شد و در متن فارسی اصلا کاربردی ندارد (بجز جایگزین کردن خط فاصله با خط تیره. روش بعدی بهتر بود.</p>

<p>با مقدار بیشتری کند و کاو متوجه شدم وقت‌گیرترین عملیاتی که این پلاگین انجام می‌دهد تولید تگ‌کلاود است. سایت من طوری است که در صفحه‌ای که برای هر تگ تولید می‌شود این تگ‌کلاود یکبار کپی می‌شود. متوجه شدم که این عملیات بارها تکرار می‌شود و نتیجه هر بار همان است. فقط کافی بود که نتیجه را ذخیره و دوباره استفاده کنم. همینکار را هم <a href="https://github.com/mehdisadeghi/jekyll-tagging-lite/blob/master/lib/jekyll-tagging-lite.rb#L121">کردم</a>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@@tag_cloud = nil

def tag_cloud(site)
  @@tag_cloud ||= active_tag_data.map { |tag, set|
      tag_link(tag, tag_url(tag), :class =&gt; "set-#{set}")
    }.join(' ')
end
</code></pre></div></div>

<p>یک متغیر استاتیک در ماژول روبی داخل پلاگین تعریف کردم تا فقط بار اول تگ‌کلاود را بسازد و دفعات بعدی همین را بازگرداند. همین تغییر حدود هفت تا هشت ثانیه روی دستگاه من در زمان بیلد صرفه‌جویی کرد.</p>

<h3 id="انتشار-به-صورت-پلاگین-مجزا">انتشار به صورت پلاگین مجزا</h3>
<p>من دوست داشتم این تغییر را به پلاگین اصلی اضافه کنم. متاسفانه به <a href="https://github.com/pattex/jekyll-tagging/issues/71">سوالی</a> که پرسیده بودم کسی جواب نداد، از طرفی پول ریکوئست‌های مرج نشده و سوالات بی‌پاسخ پیامش روشن بود، کسی وقت رسیدگی به این پروژه را ندارد. بنابراین من پروژه را فورک کردم و تحت نام <a href="https://github.com/mehdisadeghi/jekyll-tagging-lite"><code class="highlighter-rouge">jekyll-tagging-lite</code></a> منتشر کردم و از همین <a href="https://rubygems.org/gems/jekyll-tagging-lite">جم</a> در تم وبسایت استفاده کردم.</p>

<h2 id="پرهیز-از-includeهای-تکراری">پرهیز از <code class="highlighter-rouge">include</code>های تکراری</h2>
<p>هنوز هم جا داشت که بیلد سریع‌تر شود. خوشبختانه برای این قسمت قبلا کسی یک پلاگین نوشته است. بسیاری از <code class="highlighter-rouge">include</code>های استفاده شده در قالب تکراری هستند. پلاگینی بنام <a href="https://github.com/benbalter/jekyll-include-cache"><code class="highlighter-rouge">jekyll-include-cache</code></a> را به تم اضافه کردم و <code class="highlighter-rouge">inlcude</code>هایی که بعد از اولین بیلد داده‌شان تکراری است را با کمک این پلاگین کش کردم. مثلا فوتر صفحه همه‌جا تکراری است بنابراین فقط کافیست یکبار بیلد شود:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{%- include_cached footer.html -%}
</code></pre></div></div>

<h2 id="از-این-هم-سریعتر-میشود">از این هم سریع‌تر می‌شود؟</h2>
<p>حتما می‌شود. در آینده باز هم سعی خواهم کرد بیلد را سریع‌تر کنم. آنجا که منابع و زمان محدود می‌شود چیزهای بسیاری برای یاد گرفتن هست. چه بسا زبان مورد استفاده را عوض بکنم، الگوریتم‌ها را تغییر بدهم یا تا می‌توانم بی‌رحمانه دستورالعمل‌های عبث را حذف کنم تا سرعت را افزایش بدهم. دوست دارم وبسایت در چشم برهم زدنی بلید بشود. حداقل زیر یک ثانیه. الان رسیده است به ۳.۴۸۱ ثانیه.</p>

<blockquote>
  <p>آنجا که منابع و زمان محدود می‌شود چیزهای بسیاری برای یاد گرفتن هست.</p>
</blockquote>

<p>این قصه سر دراز دارد. باز هم در این باره خواهم نوشت.</p>



  
    <div id="related-posts">
      <h3>مطالب مرتبط</h3>
      <ul>
        
          <li><a href="/merciless-simplification.html">کاهش زمان بیلد به کمک پروفایلر</a></li>
        
          <li><a href="/jekyll-theme.html">انتشار قالب جکیلِ وبسایت</a></li>
        
          <li><a href="/theme-rework.html">دوباره‌نویسی تم وبسایت</a></li>
        
          <li><a href="/seo.html">افزودن متادیتا به تم وبسایت</a></li>
        
          <li><a href="/pagination.html">صفحه‌بندی در جکیل</a></li>
        
        </ul>
    </div>
  

  <small id="post-tags">
    
      <i class="fas fa-tag"></i>
      <a rel="tag" href="/tag/%D8%A8%DB%8C%D9%84%D8%AF.html">بیلد</a>
    
      <i class="fas fa-tag"></i>
      <a rel="tag" href="/tag/%D8%B1%D9%88%D8%A8%DB%8C.html">روبی</a>
    
      <i class="fas fa-tag"></i>
      <a rel="tag" href="/tag/%DA%A9%D8%B4%DB%8C%D9%86%DA%AF.html">کشینگ</a>
    
      <i class="fas fa-tag"></i>
      <a rel="tag" href="/tag/%D8%AC%DA%A9%DB%8C%D9%84.html">جکیل</a>
    
      <i class="fas fa-tag"></i>
      <a rel="tag" href="/tag/%D9%BE%D8%B1%D9%88%D9%81%D8%A7%DB%8C%D9%84%DB%8C%D9%86%DA%AF.html">پروفایلینگ</a>
    

    <i class="fas fa-code"></i>
    
    
    <a href="https://raw.githubusercontent.com/mehdisadeghi/mehdix.ir/master/_source/_posts/2018-02-05-build-faster.md">سورس</a>
    
  </small>

  <nav class="pagination">
    
      <a href="#" class="pagination--pager disabled">قبلی</a>
    

    
      <a href="https://mehdix.ir/hackerrank.html" class="pagination--pager" title="آمادگی برای مصاحبه فنی به کمک هکِررَنک">بعدی </a>
    
  </nav>

  <section>
    
      
<section id="static-comments">
  
  
  

  <form id="comment-form" name="comment" netlify-honeypot="bot-field" netlify>
    <input name="bot-field" style="display:none">
    <input name="page_id" style="display:none" value="/build-faster">
    <input id="reply-to" name="reply-to" style="display:none">
    <label for="message">دیدگاه<sup class="required">*</sup> &nbsp;<small>می‌توانید با <a href="http://commonmark.org/help/" target="_">مارک‌داون</a> هم بنویسید.</small><br><small id="replyToVisualClue"></small>
      <textarea id="message" name="message" required alt="no!!" onkeyup="preview()"></textarea>
      <div id="preview"></div>
    </label>
    <label for="name">نام<sup class="required">*</sup>
      <input id="name" type="text" name="name" required>
    </label>
    <label for="email">ایمیل<sup class="required">*</sup>
      <input id="email" type="email" name="email" required>
    </label>
    <label for="website">وبسایت
      <input id="website" type="url" name="website">
    </label>
    <div style="text-align:left">
      <button type="submit" class="button">ارسال</button>
    </div>
  </form>

</section>
<script src="https://mehdix.ir/assets/js/showdown.min.js" type="text/javascript">
</script>
<script type="text/javascript">
  function preview() {
    var converter = new showdown.Converter();
    var markdown = document.getElementById("message").value;
    document.getElementById("preview").innerHTML = converter.makeHtml(markdown);
  }

  function replyTo(commentID) {
    var comment = document.getElementById(commentID);
    document.getElementById("reply-to").value = comment.querySelector("span[commentId]").innerText;
    document.getElementById("replyToVisualClue").innerText = "[در جواب " + comment.querySelector("span[commenter]").innerText + "]";
  }
</script>
    
  </section>

</article>
</div>
    </main><footer>

  <div class="wrapper">

    

    <p id="footer-description">بچه که بودیم همیشه برای بازی خونه می‌ساختیم. حالا هم نمونه‌اش رو در وب ساختم. اینجا سکوی انتشار مطالبی در مورد دانش تولید نرم‌افزار و ایده‌ها و علایق شخصی‌ام است، بویژه راه‌حل‌های مهندسی که باعث رشد و پیشرفتم شده است و می‌تواند مورد استفاده دیگران هم قرار بگیرد.
</p>

    <ul class="social-media-list">
      
      <li>
        <i class="fab fa-github"></i>
        <a href="https://github.com/mehdisadeghi">
          <span class="username social-media-text">پروژه‌ها</span>
        </a>
      </li>
      
      
      <li>
        <i class="fab fa-twitter-square"></i>
        <a href="https://twitter.com/msadeghii">
          <span class="username social-media-text">توئیت‌ها</span>
        </a>
      </li>
      
      
      <li>
        <i class="fas fa-rss"></i>
        <a href="https://feedburner.google.com/fb/a/mailverify?uri=mehdixir&amp;loc=en_US">
          <span class="username social-media-text">خبرنامه</span></a>
      </li>
      <li>
        <i class="fas fa-rss"></i>
        <a href="http://feeds.feedburner.com/mehdixir">
        <span class="username social-media-text">خوراک</span></a>
      </li>
      
      
        <li>
          <i class="fas fa-envelope-open"></i>
          <a href="mailto:sadeghi@mehdix.org">
            <span class="username social-media-text">تماس</span></a></li>
      
    </ul>

  <div id="footer-extra">
    <small id="license">
  <i class="fab fa-creative-commons"></i>
  مطالب این وبلاگ تحت مجوز
  <a rel="license" href="http://creativecommons.org/licenses/by/4.0/deed.fa">
    کریتیو کامنز اتریبیوشن ۴.۰ اینترنشنال
  </a>قرار دارد.
</small>
    <a id="atom" href="https://validator.w3.org/feed/check.cgi?url=https://mehdix.ir/feed.xml"><img src=https://mehdix.ir/assets/img/valid-atom.png alt="[Valid Atom 1.0]" title="Validate my Atom 1.0 feed" /></a>
  </div>

  </div>

  <small id="build-time">Site generated on Tue, 06 Feb 2018 02:43:37 +0100</small>

</footer><script src="https://mehdix.ir/assets/js/main.js"></script>
     <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-57282325-1', 'auto');
  ga('send', 'pageview');

</script>
 
  </body>
</html>